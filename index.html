<!DOCTYPE html>
<html lang="es" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buscador de Instaladores</title>
  <style>
    :root{
      --bg:#f7f7fb; --text:#1c1c1f; --muted:#6b7280; --card:#ffffff; --accent:#2563eb; --chip:#eef2ff;
      --input:#ffffff; --border:#e5e7eb; --shadow:0 10px 25px rgba(0,0,0,.06);
    }
    .dark{
      --bg:#0b1220; --text:#e5e7eb; --muted:#9aa4b2; --card:#0f172a; --accent:#60a5fa; --chip:#1e293b;
      --input:#0b1220; --border:#1f2937; --shadow:0 10px 25px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    header{position:sticky;top:0;background:linear-gradient(180deg,var(--bg),rgba(0,0,0,0));padding:24px 16px 12px;backdrop-filter:saturate(160%) blur(8px)}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}
    .title{font-size:clamp(20px,3vw,28px);font-weight:800;letter-spacing:.1px}
    .subtitle{color:var(--muted);margin-top:6px}
    .toolbar{display:flex;gap:10px;margin-top:16px;align-items:center}
    .input{flex:1;display:flex;gap:8px;background:var(--input);border:1px solid var(--border);border-radius:14px;padding:10px 12px;box-shadow:var(--shadow)}
    .input input{flex:1;border:none;outline:none;background:transparent;color:var(--text);font-size:16px}
    .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;transition:.16s transform ease, .16s filter ease; display:inline-flex; align-items:center; gap:8px}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--accent);color:white}
    .btn-ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
    .btn-chip{background:var(--chip);color:var(--text);border:1px solid var(--border);font-size:13px}
    main{padding:20px 0 80px}
    .results{display:grid;grid-template-columns:repeat(1,minmax(0,1fr)); gap:12px;margin-top:14px}
    @media(min-width:640px){.results{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:980px){.results{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px 14px;box-shadow:var(--shadow)}
    .installer{font-weight:800;font-size:16px}
    .address{color:var(--muted);font-size:14px;margin-top:6px;line-height:1.4}
    .rate{margin-top:10px; font-size:13px; color:var(--text)}
    .count{color:var(--muted);font-size:13px;margin-top:10px}
    .pill{display:inline-block; padding:4px 8px; border-radius:999px; background:var(--chip); border:1px solid var(--border); font-size:12px; color:var(--muted)}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .footer-note{color:var(--muted);font-size:12px;text-align:center;margin-top:22px}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="title">Buscador de instaladores</div>
      <div class="subtitle">Fuente de datos actualizada (la que nos pegaste). Pulsa <strong>Enter</strong> para buscar. Bot√≥n de modo nocturno incluido.</div>
      <div class="toolbar">
        <div class="input" role="search">
          <input id="q" placeholder="Buscar por instalador, direcci√≥n o provincia (ej. Valencia, Alicante, Madrid)‚Ä¶" aria-label="Buscar" />
          <button id="btnSearch" class="btn btn-primary" title="Buscar (Enter)">Buscar</button>
        </div>
        <button id="btnNight" class="btn btn-ghost" title="Cambiar modo">üåô Modo nocturno</button>
        <button id="btnClear" class="btn btn-chip" title="Limpiar">Limpiar</button>
      </div>
      <div class="row" style="margin-top:10px;gap:6px">
        <span class="pill">Enter tambi√©n ejecuta la b√∫squeda</span>
        <span class="pill">Escribe la <b>provincia</b> para ver coincidencias por provincia</span>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="summary" class="count"></div>
    <div id="results" class="results" aria-live="polite"></div>
    <div class="footer-note">Ordenado por puntuaci√≥n (RATE) y nombre. Coincidencias de provincia reconocen variantes como "Val√®ncia/Valencia".</div>
  </main>

  <!--
    üëâüëâ Pega aqu√≠ ABAJO la fuente exacta que nos pasaste (TSV con cabecera INSTALLER\tAddress\tRATE).
    **No hace falta editar el JS**. El script lee este bloque de texto directamente.
  -->
  <script type="text/plain" id="dataset">
INSTALLER	Address	RATE
<!-- Pega aqu√≠ TODO el listado tal cual. B√≥rrame a m√≠ (esta l√≠nea) y deja solo los datos. -->
  </script>

  <script>
    // Lista de provincias espa√±olas (con acentos y variantes frecuentes)
    const PROVINCES = [
      "√Ålava","Albacete","Alicante","Alacant","Almer√≠a","Asturias","√Åvila","Badajoz","Barcelona",
      "Bizkaia","Vizcaya","Burgos","C√°ceres","C√°diz","Cantabria","Castell√≥n","Castell√≥","Ciudad Real",
      "C√≥rdoba","A Coru√±a","Coru√±a","Cuenca","Gipuzkoa","Guip√∫zcoa","Girona","Gerona","Granada","Guadalajara",
      "Huelva","Huesca","Illes Balears","Baleares","Ja√©n","La Rioja","Las Palmas","Le√≥n","Lleida","L√©rida",
      "Lugo","Madrid","M√°laga","Mallorca","Menorca","Ourense","Orense","Palencia","Pontevedra","Salamanca",
      "Santa Cruz de Tenerife","Segovia","Sevilla","Soria","Tarragona","Teruel","Toledo","Valencia","Val√®ncia",
      "Valladolid","Zamora","Zaragoza","Ceuta","Melilla"
    ].map(p=>p.toLowerCase());

    const $q = document.getElementById('q');
    const $results = document.getElementById('results');
    const $summary = document.getElementById('summary');
    const $btnSearch = document.getElementById('btnSearch');
    const $btnNight = document.getElementById('btnNight');
    const $btnClear = document.getElementById('btnClear');

    // NIGHT MODE toggle
    const root = document.documentElement; // <html>
    function setNight(on){
      root.classList.toggle('dark', !!on);
      root.classList.toggle('light', !on);
      localStorage.setItem('night', on ? '1' : '');
      $btnNight.textContent = on ? '‚òÄÔ∏è Modo claro' : 'üåô Modo nocturno';
    }
    setNight(localStorage.getItem('night')==='1');
    $btnNight.addEventListener('click', ()=> setNight(!root.classList.contains('dark')));

    function parseTSV(text){
      const lines = text.trim().split(/\r?\n/).filter(Boolean);
      if(!lines.length) return [];
      // tolerate commas inside addresses; separator is tab
      const rows = lines.map(l => l.split(/\t+/));
      // detect header
      const hasHeader = rows[0].length>=3 && /install|address|rate/i.test(rows[0].join(' '));
      const start = hasHeader ? 1 : 0;
      const out = [];
      for(let i=start;i<rows.length;i++){
        const cols = rows[i];
        if(cols.length<3) continue;
        const [installer,address,rate] = [cols[0].trim(), cols[1].trim(), parseFloat(cols[2])||0];
        if(installer && address) out.push({installer, address, rate});
      }
      return out;
    }

    function loadData(){
      const raw = document.getElementById('dataset').textContent; // from <script type=text/plain>
      return parseTSV(raw);
    }

    const DATA = loadData();

    function findMatches(q){
      if(!q) return DATA;
      q = q.trim().toLowerCase();
      const isProvinceQuery = PROVINCES.includes(q);
      return DATA.filter(row => {
        const name = row.installer.toLowerCase();
        const addr = row.address.toLowerCase();
        if(isProvinceQuery){
          // Provincia exacta: contiene la palabra provincia como token o tras una coma
          return addr.includes(q);
        }
        // B√∫squeda general: nombre instalador, direcci√≥n o posible provincia parcial
        return name.includes(q) || addr.includes(q);
      });
    }

    function render(list, q){
      // ordenar por rate desc, luego instalador asc
      const rows = [...list].sort((a,b)=> (b.rate-a.rate) || a.installer.localeCompare(b.installer));
      $results.innerHTML = rows.map(r => `
        <article class="card">
          <div class="installer">${escapeHtml(r.installer)}</div>
          <div class="address">${highlight(escapeHtml(r.address), q)}</div>
          <div class="rate">‚≠ê ${r.rate.toFixed(1)}</div>
        </article>
      `).join('');
      const count = rows.length;
      const extra = q ? ` para "${escapeHtml(q)}"` : '';
      $summary.innerHTML = `${count} resultado${count!==1?'s':''}${extra}`;
    }

    function highlight(text, q){
      if(!q) return text;
      try{
        const re = new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'ig');
        return text.replace(re, '<mark>$1</mark>');
      }catch(e){return text}
    }
    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
    }

    function doSearch(){
      const q = $q.value.trim();
      const hits = findMatches(q);
      render(hits, q);
    }

    // Eventos: bot√≥n, Enter, limpiar
    $btnSearch.addEventListener('click', doSearch);
    $q.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){ e.preventDefault(); doSearch(); }
    });
    $btnClear.addEventListener('click', ()=>{ $q.value=''; doSearch(); $q.focus(); });

    // Render inicial
    render(DATA, '');
  </script>
</body>
</html>
