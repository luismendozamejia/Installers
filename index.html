<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Instaladores por comunidad autónoma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #9ca3af;
      --text: #e5e7eb;
      --accent: #22c55e;
      --accent-2: #38bdf8;
      --border: #1f2937;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(120deg, #0b1020, #121a33 60%, #0b1020);
      color: var(--text);
      min-height: 100dvh; display: grid; place-items: start center;
      padding: 32px 16px;
    }
    .app {
      width: min(1100px, 100%);
      background: color-mix(in srgb, var(--card), transparent 12%);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      overflow: clip;
    }
    header {
      padding: 22px 22px 12px;
      border-bottom: 1px solid var(--border);
      display: grid; gap: 10px;
    }
    header h1 {
      margin: 0; font-size: 18px; font-weight: 700; letter-spacing: .2px;
    }
    .controls {
      display: grid; gap: 8px;
    }
    .row {
      display: grid; grid-template-columns: 1fr auto auto; gap: 8px;
    }
    input[type="search"] {
      width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid var(--border);
      background: #0b1224; color: var(--text); outline: none;
    }
    .btn {
      border: 1px solid var(--border);
      background: #0b1224;
      color: var(--text);
      padding: 10px 12px; border-radius: 12px; cursor: pointer;
    }
    .btn:hover { border-color: color-mix(in srgb, var(--accent), white 70%); }
    .btn.primary { background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0b1020; border: none; font-weight: 700; }
    .hint { color: var(--muted); font-size: 12px; }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      text-align: left; padding: 12px 16px; font-size: 12px; color: var(--muted);
      border-bottom: 1px solid var(--border); user-select: none; cursor: pointer;
      position: sticky; top: 0; backdrop-filter: blur(6px);
      background: color-mix(in srgb, #0b1020, transparent 10%);
    }
    tbody td {
      padding: 12px 16px; border-bottom: 1px solid var(--border);
      vertical-align: top; line-height: 1.35;
    }
    tbody tr:hover { background: color-mix(in srgb, #0b1224, transparent 50%); }
    .empty {
      padding: 22px; color: var(--muted); text-align: center;
    }
    @media (max-width: 720px) {
      .row { grid-template-columns: 1fr; }
      thead th:nth-child(2), tbody td:nth-child(2) { font-size: 14px; }
    }
  </style>
</head>
<body>
  <main class="app" id="app">
    <header>
      <h1>Instaladores y regiones de actuación</h1>
      <div class="controls">
        <div class="row">
          <input id="search" type="search" placeholder="Buscar por instalador o comunidad… (p. ej. Madrid, Andalucía, Kaylon)" />
          <button class="btn" id="clear">Limpiar</button>
          <button class="btn primary" id="download">Descargar CSV</button>
        </div>
        <div class="hint" id="countHint"></div>
      </div>
    </header>

    <section>
      <table id="grid" aria-describedby="Tabla de instaladores por comunidades">
        <thead>
          <tr>
            <th data-key="Instalador">Instalador <span aria-hidden="true">↕</span></th>
            <th data-key="Comunidades autónomas donde actúa (según direcciones)">Comunidades autónomas donde actúa (según direcciones) <span aria-hidden="true">↕</span></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <div class="empty" id="empty" hidden>No hay resultados con ese filtro.</div>
    </section>
  </main>

  <script>
    // ----------------------------
    // Datos (sustituidos tal y como pediste)
    // ----------------------------
    const DATA = [
      {
        "Instalador": "BAINGA",
        "Comunidades autónomas donde actúa (según direcciones)": "Comunitat Valenciana"
      },
      {
        "Instalador": "BSSPAIN",
        "Comunidades autónomas donde actúa (según direcciones)": "Andalucía, Castilla-La Mancha, Castilla y León, Comunidad de Madrid, Comunitat Valenciana, Región de Murcia"
      },
      {
        "Instalador": "ECO AMPER SL",
        "Comunidades autónomas donde actúa (según direcciones)": "Comunitat Valenciana, Región de Murcia"
      },
      {
        "Instalador": "Ecofutur",
        "Comunidades autónomas donde actúa (según direcciones)": "Comunitat Valenciana"
      },
      {
        "Instalador": "EEGA Suministros Energéticos",
        "Comunidades autónomas donde actúa (según direcciones)": "Galicia"
      },
      {
        "Instalador": "Era Renovables",
        "Comunidades autónomas donde actúa (según direcciones)": "Andalucía, Aragón"
      },
      {
        "Instalador": "FUERZA&HONOR SL",
        "Comunidades autónomas donde actúa (según direcciones)": "Illes Balears, Andalucía"
      },
      {
        "Instalador": "Grupo Ecosar",
        "Comunidades autónomas donde actúa (según direcciones)": "Asturias, Cantabria, País Vasco, Galicia, Castilla y León, Comunidad de Madrid"
      },
      {
        "Instalador": "GRUPO MQ LA MANCHA S.L.U",
        "Comunidades autónomas donde actúa (según direcciones)": "Castilla-La Mancha, Comunidad de Madrid, Andalucía, Aragón"
      },
      {
        "Instalador": "JOVITEL SL",
        "Comunidades autónomas donde actúa (según direcciones)": "Andalucía"
      },
      {
        "Instalador": "KAYLON ENERGIAS RENOVABLES S.L.",
        "Comunidades autónomas donde actúa (según direcciones)": "Cataluña, Comunidad de Madrid, Castilla-La Mancha, Castilla y León, Aragón, Navarra, País Vasco, Cantabria, Extremadura"
      },
      {
        "Instalador": "PROYECTOS ENERGÉTICOS INERGYA, S.L.",
        "Comunidades autónomas donde actúa (según direcciones)": "Región de Murcia, Comunitat Valenciana"
      }
    ];

    // ---------- utilidades ----------
    const $ = (sel, el = document) => el.querySelector(sel);
    const $$ = (sel, el = document) => [...el.querySelectorAll(sel)];

    // Render
    const tbody = $("#tbody");
    const empty = $("#empty");
    const countHint = $("#countHint");
    let sortKey = "Instalador";
    let sortDir = 1; // 1 asc, -1 desc
    let current = [...DATA];

    function normalize(str) {
      return (str ?? "").toString().toLowerCase()
        .normalize("NFD").replace(/\p{Diacritic}/gu, "");
    }

    function render(rows) {
      tbody.innerHTML = rows.map(r => `
        <tr>
          <td><strong>${escapeHtml(r["Instalador"])}</strong></td>
          <td>${escapeHtml(r["Comunidades autónomas donde actúa (según direcciones)"])}</td>
        </tr>
      `).join("");
      empty.hidden = rows.length !== 0;
      countHint.textContent = `${rows.length} ${rows.length === 1 ? "instalador" : "instaladores"} mostrados`;
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;");
    }

    function sortBy(key) {
      if (sortKey === key) sortDir *= -1; else { sortKey = key; sortDir = 1; }
      current.sort((a, b) => {
        const A = normalize(a[key]);
        const B = normalize(b[key]);
        return A.localeCompare(B, "es") * sortDir;
      });
      render(current);
      markHeader();
    }

    function markHeader() {
      $$("thead th").forEach(th => {
        th.style.color = "var(--muted)";
        th.style.textDecoration = "none";
      });
      const th = $(`thead th[data-key="${CSS.escape(sortKey)}"]`);
      if (th) {
        th.style.color = "white";
        th.style.textDecoration = "underline";
        th.querySelector("span").textContent = sortDir === 1 ? "↑" : "↓";
      }
    }

    // Filtro
    const search = $("#search");
    $("#clear").addEventListener("click", () => {
      search.value = ""; applyFilter();
      search.focus();
    });
    search.addEventListener("input", applyFilter);

    function applyFilter() {
      const q = normalize(search.value);
      current = DATA.filter(r => {
        const a = normalize(r["Instalador"]);
        const b = normalize(r["Comunidades autónomas donde actúa (según direcciones)"]);
        return a.includes(q) || b.includes(q);
      });
      // mantener orden actual
      current.sort((a, b) => {
        const A = normalize(a[sortKey]);
        const B = normalize(b[sortKey]);
        return A.localeCompare(B, "es") * sortDir;
      });
      render(current);
    }

    // Descargar CSV
    $("#download").addEventListener("click", () => {
      const headers = ["Instalador","Comunidades autónomas donde actúa (según direcciones)"];
      const lines = [
        headers.join(";"),
        ...current.map(r => headers.map(h => csvCell(r[h])).join(";"))
      ];
      const blob = new Blob([lines.join("\n")], { type: "text/csv;charset=utf-8" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "instaladores_por_ccaa.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(a.href);
    });

    function csvCell(v) {
      const s = String(v ?? "");
      if (/[;"\n]/.test(s)) return `"${s.replaceAll('"','""')}"`;
      return s;
    }

    // Eventos cabecera
    $$("thead th").forEach(th => {
      th.addEventListener("click", () => sortBy(th.dataset.key));
    });

    // init
    sortBy("Instalador"); // inicializa sort + render
  </script>
</body>
</html>
